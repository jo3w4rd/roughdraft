<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');</script>
    <script type="text/javascript">thisPackageMetaData = { name: "com.unity.entities", version: "0.17.0-preview.18", displayTitle:"Entities 0.17.0-preview.18", lang: "en" };</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
  
    <title>Property Entities
   | Entities | 0.17.0-preview.18 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Property Entities
   | Entities | 0.17.0-preview.18 ">
    <meta name="generator" content="docfx 2.51.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/version-switcher.css">
    <link rel="stylesheet" href="../styles/language-switcher.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta property="unity:packageTitle" content="Entities | 0.17.0-preview.18">
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" class="">
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
        
        		<div class="back-to-unity-group">
        			<a class="back-to-unity" href="http://docs.unity3d.com/">docs.unity3d.com</a>
        		</div>
        
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10" id="main_content">
          <div id="breadcrumb_placeholder"></div>
            <article class="content wrap" id="_content" data-uid="Unity.Entities.SystemBase.Entities*">

<h1 id="Unity_Entities_SystemBase_Entities_" data-uid="Unity.Entities.SystemBase.Entities*">Property Entities
</h1>
<div class="markdown level0 summary"></div>
<div class="markdown level0 conceptual"></div>



<a id="Unity_Entities_SystemBase_Entities_" data-uid="Unity.Entities.SystemBase.Entities*"></a>
<h4 id="Unity_Entities_SystemBase_Entities" data-uid="Unity.Entities.SystemBase.Entities">Entities</h4>
<div class="markdown level1 summary"><p>Provides a mechanism for defining an entity query and invoking a lambda expression on each entity
selected by that query.</p>
</div>
<div class="markdown level1 conceptual"></div>
<h5 class="decalaration">Declaration</h5>
<div class="codewrapper">
  <pre><code class="lang-csharp hljs">protected ForEachLambdaJobDescription Entities { get; }</code></pre>
</div>
<h5 class="propertyValue">Property Value</h5>
<table class="table table-bordered table-striped table-condensed">
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><span class="xref">Unity.Entities.CodeGeneratedJobForEach.ForEachLambdaJobDescription</span></td>
      <td></td>
    </tr>
  </tbody>
</table>
<h5 id="Unity_Entities_SystemBase_Entities_remarks">Remarks</h5>
<div class="markdown level1 remarks"><p>The Entities property provides a convenient mechanism for implementing the most common operation
performed by systems in ECS, namely, iterating over a set of entities to read and update component
data. Entities provides a LINQ method-style syntax that you use to describe the work to be performed.
Unity uses a compiler extension to convert the description into efficient, (optionally) multi-threaded
executable code.</p>
<example>
<pre><code class="lang-csharp" source="../DocCodeSamples.Tests/SystemBaseExamples.cs" region="entities-foreach-basic">       Entities
           .WithName(&quot;Update_Position&quot;) // Shown in error messages and profiler
           .WithAll&lt;LocalToWorld>() // Require the LocalToWorld component
           .ForEach(
               // Write to Displacement (ref), read Velocity (in)
               (ref Position position, in Velocity velocity) =>
               {
                   //Execute for each selected entity
                   position = new Position()
                   {
                       // dT is a captured variable
                       Value = position.Value + velocity.Value * dT
                   };
               }
           )
           .ScheduleParallel(); // Schedule as a parallel job</code></pre>
</example>

<h5 id="describing-the-entity-query"><strong>Describing the entity query</strong></h5>
<p>The components that you specify as parameters for your lambda function are automatically added to
the entity query created for an Entities.Foreach construction. You can also add a number of &quot;With&quot;
clauses to identify which entities that you want to process These clauses include:</p>
<ul>
<li><p><strong><code>WithAll</code></strong> -- An entity must have all of these component types (in addition to having all
the component types found in the lambda parameter list).</p>
</li>
<li><p><strong><code>WithAny</code></strong> -- An entity must have one or more of these component types.</p>
</li>
<li><p><strong><code>WithNone</code></strong> -- An entity must not have any of these component types.</p>
</li>
<li><p><strong><code>WithChangeFilter()</code></strong> -- Only selects entities in chunks in which the specified component might have
changed since the last time this system instance updated.</p>
</li>
<li><p><strong><code>WithSharedComponentFilter(ISharedComponentData)</code></strong> -- Only select chunks that have a specified value
for a shared component.</p>
</li>
<li><p><strong><code>WithEntityQueryOptions(EntityQueryOptions)</code></strong> -- Specify additonal options defined in a
<a class="xref" href="Unity.Entities.EntityQueryOptions.html">EntityQueryOptions</a> object.</p>
</li>
<li><p><strong><code>WithStoreEntityQueryInField(EntityQuery)</code></strong> -- Stores the <a class="xref" href="Unity.Entities.EntityQuery.html">EntityQuery</a> object generated
by the Entities.ForEach in an EntityQuery field on your system. You can use this EntityQuery object for
such purposes as getting the number of entities that will be selected by the query. Note that this function
assigns the EntityQuery instance to your field
when the system is created. This means that you can use the query before the first execution of the
lambda function.</p>
</li>
</ul>
<h5 id="defining-the-lambda-function"><strong>Defining the lambda function</strong></h5>
<p>Define the lambda function inside the <code>ForEach()</code> method of the entities property. When the system invokes the
lambda function, it assigns values to the function parameters based on the current entity. You can pass ECS
component types as parameters as well as a set of special, named parameters.</p>
<ol>
<li>Parameters passed-by-value first (no parameter modifiers)</li>
<li>Writable parameters second(<code>ref</code> parameter modifier)</li>
<li>Read-only parameters last(<code>in</code> parameter modifier)</li>
</ol>
<p>All components should use either the <code>ref</code> or the <code>in</code> parameter modifier keywords.</p>
<p>You can pass up to eight parameters to the lambda function. In addition to ECS component types, you can use
the following:</p>
<ul>
<li><p><strong><code>Entity entity</code></strong> — the Entity instance of the current entity. (The parameter can be named anything as
long as the type is Entity.)</p>
</li>
<li><p><strong><code>int entityInQueryIndex</code></strong> — the index of the entity in the list of all entities selected by the query.
Use the entity index value when you have a <a href="https://docs.unity3d.com/ScriptReference/Unity.Collections.NativeArray_1.html">native array</a> that you need to fill with a unique value for
each entity. You can use the entityInQueryIndex as the index in that array. The entityInQueryIndex should
also be used as the <code>sortKey</code> for adding commands to a concurrent <a class="xref" href="Unity.Entities.EntityCommandBuffer.html">EntityCommandBuffer</a>.</p>
</li>
<li><p><strong><code>int nativeThreadIndex</code></strong> — a unique index for the thread executing the current iteration of the
lambda function. When you execute the lambda function using Run(), nativeThreadIndex is always zero.</p>
</li>
</ul>
<example>
<pre><code class="lang-csharp" source="../DocCodeSamples.Tests/SystemBaseExamples.cs" region="lambda-params">           .ForEach((Entity entity,
           int entityInQueryIndex,
           ref WritableComponent aReadwriteComponent,
           in ReadonlyComponent aReadonlyComponent) =>
           {
               /*..*/
           })</code></pre>
</example>

<h5 id="capturing-variables"><strong>Capturing variables</strong></h5>
<p>You can capture local variables in the lambda function. When you execute the function using a job (by
calling <code>ScheduleParallel()</code> or <code>ScheduleSingle()</code> instead of <code>Run()</code>) there are some restrictions on the
captured variables and how you use them:</p>
<ul>
<li>Only native containers and blittable types can be captured.</li>
<li>A job can only write to captured variables that are native containers.
(To “return” a single value, create a <a href="https://docs.unity3d.com/ScriptReference/Unity.Collections.NativeArray_1.html">native array</a> with one element.)</li>
</ul>
<p>You can use the following functions to apply modifiers and attributes to the captured <a href="https://docs.unity3d.com/ScriptReference/Unity.Collections.LowLevel.Unsafe.NativeContainerAttribute.html">native container</a>
variables, including <a href="https://docs.unity3d.com/ScriptReference/Unity.Collections.NativeArray_1.html">native arrays</a>. See <a class="xref" href="Unity.Entities.SystemBase.Job.html#Unity_Entities_SystemBase_Job">Job.WithCode</a> for a list of these modifiers and attributes.</p>
<h5 id="executing-the-lambda-function"><strong>Executing the lambda function</strong></h5>
<p>To execute a ForEach construction, you have three options:</p>
<ul>
<li><p><strong><code>ScheduleParallel()</code></strong> -- schedules the work to be done in parallel using the <a href="https://docs.unity3d.com/2019.2/Documentation/Manual/JobSystem.html">C# Job</a> system. Each
parallel job instance processes at least one chunk of entities at a time. In other words, if all the
selected entities are in the same chunk, then only one job instance is spawned.</p>
</li>
<li><p><strong><code>Schedule()</code></strong> -- schedules the work to be done in a single job (no matter how many entities are
selected).</p>
</li>
<li><p><strong><code>Run()</code></strong> -- evaluates the entity query and invokes the lambda function for each selected entity
immediately on the main thread. Calling <code>Run()</code> completes the system <a class="xref" href="Unity.Entities.SystemBase.Dependency.html#Unity_Entities_SystemBase_Dependency">Dependency</a> <a href="https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.html">JobHandle</a>
before running, blocking the main thread, if necessary, while it waits for those jobs to finish.</p>
</li>
</ul>
<p>When you call Schedule() or ScheduleParallel() without parameters, then the scheduled jobs use the current
value of <a class="xref" href="Unity.Entities.SystemBase.Dependency.html#Unity_Entities_SystemBase_Dependency">Dependency</a>. You can also pass a <a href="https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.html">JobHandle</a> to these functions to define the dependencies
of the scheduled job. In this case, the Entities.forEach construction returns a new <a href="https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.html">JobHandle</a> that adds the
scheduled job to the passed in <a href="https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.html">JobHandle</a>. See <a class="xref" href="Unity.Entities.SystemBase.Dependency.html#Unity_Entities_SystemBase_Dependency">Dependency</a> for more information.</p>
<h5 id="additional-options"><strong>Additional options</strong></h5>
<ul>
<li><strong><code>WithName(string)</code></strong> -— assigns the specified string as the name of the generated job class. Assigning
a name is optional, but can help identify the function when debugging and profiling.</li>
<li><strong><code>WithStructuralChanges()</code></strong> -— executes the lambda function on the main thread and disables Burst so
that you can make structural changes to your entity data within the function. For better performance, use
an <a class="xref" href="Unity.Entities.EntityCommandBuffer.html">EntityCommandBuffer</a> instead.</li>
<li><strong><code>WithoutBurst()</code></strong> —- disables Burst compilation. Use this function when your lambda function contains
code not supported by Burst or while debugging.</li>
<li><strong><code>WithBurst(FloatMode, FloatPrecision, bool)</code></strong> — sets options for the Burst compiler:<ul>
<li><strong>floatMode</strong> —- sets the floating point math optimization mode.Fast mode executes faster, but
produces larger floating point error than Strict mode.Defaults to Strict. See <a href="https://docs.unity3d.com/Packages/com.unity.burst@latest?subfolder=/api/Unity.Burst.FloatMode.html">Burst FloatMode</a>.</li>
<li><strong>floatPrecision</strong> —- sets the floating point math precision. See <a href="https://docs.unity3d.com/Packages/com.unity.burst@latest?subfolder=/api/Unity.Burst.FloatPrecision.html">Burst FloatPrecision</a>.</li>
<li><strong>synchronousCompilation</strong> —- compiles the function immediately instead of scheduling the function
for compilation later.</li>
</ul>
</li>
</ul>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2020 Unity Technologies<br>Generated by <strong>DocFX</strong></span> on Wednesday, October 28, 2020
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    <script type="text/javascript" src="../styles/metadata-collector.js"></script>
    <script type="text/javascript" src="../styles/version-switcher.js"></script>
    <script type="text/javascript" src="../styles/language-switcher.js"></script>
  </body>
</html>
