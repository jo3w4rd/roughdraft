<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');</script>
    <script type="text/javascript">thisPackageMetaData = { name: "com.unity.entities", version: "0.17.0-preview.18", displayTitle:"Entities 0.17.0-preview.18", lang: "en" };</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
  
    <title>DOTS Hybrid Components | Entities | 0.17.0-preview.18 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="DOTS Hybrid Components | Entities | 0.17.0-preview.18 ">
    <meta name="generator" content="docfx 2.51.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/version-switcher.css">
    <link rel="stylesheet" href="../styles/language-switcher.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta property="unity:packageTitle" content="Entities | 0.17.0-preview.18">
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" class="">
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
        
        		<div class="back-to-unity-group">
        			<a class="back-to-unity" href="http://docs.unity3d.com/">docs.unity3d.com</a>
        		</div>
        
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10" id="main_content">
          <div id="breadcrumb_placeholder"></div>
            <article class="content wrap" id="_content" data-uid="hybrid_components">
<h1 id="dots-hybrid-components">DOTS Hybrid Components</h1>

<h2 id="prelude">Prelude</h2>
<p>Please note that Hybrid Components are not compatible with <a href="https://docs.unity3d.com/Packages/com.unity.tiny.all@latest">Project Tiny</a>.</p>
<h2 id="purpose">Purpose</h2>
<p>Many existing features of Unity don’t have a DOTS equivalent (yet). So in many cases, DOTS projects will be hybrid: a mix of classic GameObjects and ECS.</p>
<p>Hybrid Components provide a way to conveniently access UnityEngine components from ECS code. They were initially designed to deal with rendering components like lights, reflection probes, post-process volumes, etc.</p>
<p>The major limitations associated with Hybrid Components include:</p>
<ul>
<li>Only for data-like components, most <a href="https://docs.unity3d.com/Manual/EventFunctions.html">event functions</a> won’t be called.</li>
<li>No performance benefits over GameObjects, including no jobs, no Burst, no improvement in memory usage.</li>
<li>Not a general purpose feature, the use of hybrid components is explicit (opt-in).</li>
<li>As of entities 0.16, hybrid components aren’t fully supported by LiveLink.</li>
<li>Hybrid Components can only be created at conversion time.</li>
</ul>
<h2 id="component-objects">Component Objects</h2>
<p>Hybrid Components are implemented on top of <a class="xref" href="https://docs.unity3d.com/2020.1/Documentation/ScriptReference/Component.html">Component</a> objects, so let’s first discuss what Component objects are.
Component objects are regular UnityEngine components added to an entity by using <a class="xref" href="../api/Unity.Entities.EntityManager.AddComponentObject.html">AddComponentObject</a> and accessed via <a class="xref" href="../api/Unity.Entities.EntityManager.GetComponentObject.html">GetComponentObject</a>, allowing those types of components to be used in queries and a few other places.</p>
<p>Internally, references to such components are not stored in chunks but in managed arrays. The chunks only contain indices to those arrays instead of storing the components themselves.</p>
<p>This means that every access to a Component object requires an extra indirection and also that the entities don’t &quot;own&quot; those components. You must use caution when dealing with Component objects because of the chance that many problematic situations can arise because of this lack of clearly defined ownership. For example, it is possible to share the same component between multiple entities or to destroy components without removing them.</p>
<h2 id="companion-gameobjects">Companion GameObjects</h2>
<p>Hybrid components were designed to solve the ownership problem of <a class="xref" href="https://docs.unity3d.com/2020.1/Documentation/ScriptReference/Component.html">Component</a> objects.</p>
<p>Since regular UnityEngine components cannot exist on their own, hybrid components use hidden GameObjects (via <code>HideFlags</code>) that we call &quot;Companion GameObjects&quot; in this context.</p>
<p>ECS makes the management of these companion GameObjects transparent in a way that your code should never have to worry about them.</p>
<div class="NOTE"><h5>Note</h5><p>The design is based on the constraint that the entity is in charge of the companion GameObject. The GameObject shouldn’t modify the entity or its other components.</p>
</div>
<h2 id="conversion">Conversion</h2>
<p>Conversion systems can declare some UnityEngine component instances from the authoring GameObjects as hybrid components by using <a class="xref" href="../api/Global-Namespace.GameObjectConversionSystem.AddHybridComponent.html">AddHybridComponent</a>.</p>
<pre><code class="lang-cs" name="conversion">[ConverterVersion(&quot;unity&quot;, 1)]
public class DoohickeyConversionSystem : GameObjectConversionSystem
{
    protected override void OnUpdate()
    {
        Entities.ForEach((Doohickey doohickey) =&gt;
        {
            AddHybridComponent(doohickey);
        });
    }
}
</code></pre><p>At the end of conversion, each authoring GameObject that has at least one hybrid component will be cloned, all the other components will be removed from the clone, and that clone will be stored alongside the entity and become its companion GameObject.</p>
<h2 id="companionlink">CompanionLink</h2>
<p>The link between an entity and its companion GameObject is aptly named <code>CompanionLink</code>. A <code>CompanionLink</code> is a managed component (<code>IComponentData</code> class) that also implements <code>IDisposable</code> and <code>ICloneable</code>. This component manages the lifecycle of the companion GameObject and contains a reference to the GameObject.</p>
<p>This allows entity prefab instantiation and entity destruction to just work transparently.</p>
<div class="NOTE"><h5>Note</h5><p>This is a one way link from an entity to a companion GameObject. There is no link back from the companion GameObject to the entity.</p>
</div>
<h2 id="copy-to-gameobjecttransform">Copy to GameObject.Transform</h2>
<p>If it exists, the transform matrix in the <code>LocalToWorld</code> component of the entity is copied to its companion GameObject’s <code>Transform</code>. Those GameObjects are always in world space, the transform hierarchy only exists on the ECS side.</p>
<div class="NOTE"><h5>Note</h5><p>This copy only happens in one direction. Direct modification of the companion’s transform is an error, it will be overwritten by the synchronization system eventually. Since this synchronization system is reactive, there is no guarantee when this will happen. It is only guaranteed to happen when the <code>LocalToWorld</code> component of the entity is modified.</p>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2020 Unity Technologies<br>Generated by <strong>DocFX</strong></span> on Monday, November 2, 2020
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    <script type="text/javascript" src="../styles/metadata-collector.js"></script>
    <script type="text/javascript" src="../styles/version-switcher.js"></script>
    <script type="text/javascript" src="../styles/language-switcher.js"></script>
  </body>
</html>
