<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Version Numbers </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Version Numbers ">
    <meta name="generator" content="docfx 2.40.7.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>

            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../manual/ecs_principles_and_vision.html" title="Manual">Manual</a>
                      </li>
                      <li>
                          <a href="../../api/Unity.Collections.html" title="Script Reference">Script Reference</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <a href="../ecs_principles_and_vision.html" title="The Unity Data-Oriented Tech Stack project" class="">The Unity Data-Oriented Tech Stack project</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../getting_started/getting_started.html" title="Getting started" class="">Getting started</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../getting_started/ecs_introduction.html" title="Entity Component Systems" class="">Entity Component Systems</a>
                          </li>
                          <li class="">
                            <a href="../getting_started/hello_ecs.html" title="Hello (ECS) World" class="">Hello (ECS) World</a>
                          </li>
                          <li class="">
                            <a href="../getting_started/samples_overview.html" title="Samples" class="">Samples</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../com.unity.entities/index.html" title="Unity Entity Component System" class="">Unity Entity Component System</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../com.unity.entities/index.html" title="Overview" class="">Overview</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../com.unity.entities/index.html" title="Core ECS" class="">Core ECS</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <span class="expand-stub"></span>
                                  <a href="../com.unity.entities/ecs_entities.html" title="Entities" class="">Entities</a>
                                    
                                    <ul class="nav level4">
                                      <li class="">
                                        <a href="../com.unity.entities/world.html" title="Worlds" class="">Worlds</a>
                                      </li>
                                    </ul>  </li>
                                <li class="">
                                  <span class="expand-stub"></span>
                                  <a href="../com.unity.entities/ecs_components.html" title="Components" class="">Components</a>
                                    
                                    <ul class="nav level4">
                                      <li class="">
                                        <a href="../com.unity.entities/component_data.html" title="General Purpose Components" class="">General Purpose Components</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/shared_component_data.html" title="Shared Components" class="">Shared Components</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/system_state_components.html" title="System State Components" class="">System State Components</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/dynamic_buffers.html" title="Dynamic Buffer Components" class="">Dynamic Buffer Components</a>
                                      </li>
                                    </ul>  </li>
                                <li class="">
                                  <span class="expand-stub"></span>
                                  <a href="../com.unity.entities/ecs_systems.html" title="System" class="">System</a>
                                    
                                    <ul class="nav level4">
                                      <li class="">
                                        <a href="../com.unity.entities/component_system.html" title="Component Systems" class="">Component Systems</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/job_component_system.html" title="Job Component Systems" class="">Job Component Systems</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/entity_command_buffer.html" title="Entity Command Buffers" class="">Entity Command Buffers</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/system_update_order.html" title="System Update Order" class="">System Update Order</a>
                                      </li>
                                    </ul>  </li>
                                <li class="">
                                  <span class="expand-stub"></span>
                                  <a href="../com.unity.entities/chunk_iteration.html" title="Accessing Entity Data" class="">Accessing Entity Data</a>
                                    
                                    <ul class="nav level4">
                                      <li class="">
                                        <a href="../com.unity.entities/entity_iteration_job.html" title="Using IJobProcessComponentData" class="">Using IJobProcessComponentData</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/chunk_iteration_job.html" title="Using IJobChunk" class="">Using IJobChunk</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/entity_iteration_foreach.html" title="Using ComponentSystem and ForEach" class="">Using ComponentSystem and ForEach</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/manual_iteration.html" title="Manual iteration" class="">Manual iteration</a>
                                      </li>
                                      <li class="">
                                        <a href="../com.unity.entities/component_group.html" title="Component Groups" class="">Component Groups</a>
                                      </li>
                                    </ul>  </li>
                                <li class="active">
                                  <a href="../com.unity.entities/version_numbers.html" title="Versions and Generations" class="active">Versions and Generations</a>
                                </li>
                                <li class="">
                                  <span class="expand-stub"></span>
                                  <a href="../com.unity.entities/ecs_job_overview.html" title="Jobs in ECS" class="">Jobs in ECS</a>
                                    
                                    <ul class="nav level4">
                                      <li class="">
                                        <a href="../com.unity.entities/ecs_job_extensions.html" title="ECS Job System extensions" class="">ECS Job System extensions</a>
                                      </li>
                                    </ul>  </li>
                              </ul>  </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../com.unity.entities/index.html" title="Creating Gameplay" class="">Creating Gameplay</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../com.unity.entities/transform_system.html" title="Transforms" class="">Transforms</a>
                                </li>
                                <li class="">
                                  <a href="../com.unity.entities/gp_rendering.html" title="Rendering" class="">Rendering</a>
                                </li>
                              </ul>  </li>
                        </ul>  </li>
                    <li class="">
                      <a href="../cheatsheet.html" title="Quick Reference" class="">Quick Reference</a>
                    </li>
                    <li class="">
                      <a href="../glossary.html" title="Glossary" class="">Glossary</a>
                    </li>
                    <li class="">
                      <a href="../resources.html" title="Learning Resources" class="">Learning Resources</a>
                    </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="ecs-version-numbers">
<h1 id="version-numbers">Version Numbers</h1>

<h2 id="scope">Scope</h2>
<p>The purpose of version numbers (aka. generations) is the detection of potential changes. Amongst other things, they can be used to implement cheap and efficient optimization strategies, e.g. some processing might be skipped when the data it operates on is guaranteed not to have changed since last frame.</p>
<p>It often happens that by performing a very quick conservative version check for a bunch of entities at once, significant performance gains can be easily obtained.</p>
<p>This page lists and documents all the different version numbers used by ECS, in particular conditions that will cause them to change.</p>
<h2 id="preliminary-remarks">Preliminary Remarks</h2>
<p>All version numbers are 32 bits signed integers, they always increase unless they wrap around, signed integer overflow is defined behavior in C#. This means that comparing version numbers should be done using the (in)equality operator, not relational operators.</p>
<p>The right way to check if VersionB is more recent than VersionA is:
<code>bool VersionBIsMoreRecent = (VersionB - VersionA) &gt; 0;</code></p>
<p>There is usually no guarantee by how much a version number will increase.</p>
<h2 id="entityidversion">EntityId.Version</h2>
<p>An <code>EntityId</code> is made of an index and a version number. Since indices are recycled, the version number is increased in <code>EntityManager</code> every time the entity is destroyed. If there is a mismatch in the version numbers when an <code>EntityId</code> is looked up in <code>EntityManager</code>, it means the entity referred to doesn’t exist anymore.</p>
<blockquote><p>Before fetching the position of the enemy some unit is tracking via an EntityId, you can call <code>ComponentDataFromEntity.Exists</code> that uses the version number to check if the entity still exists.</p>
</blockquote>
<h2 id="worldversion">World.Version</h2>
<p>The version number of a world is increased every time a manager (i.e. system) is created or destroyed.</p>
<h2 id="entitydatamanagerglobalversion">EntityDataManager.GlobalVersion</h2>
<p>Is increased before every single (job) component system update.</p>
<blockquote><p>The purpose of this version number is to be used in conjunction with <code>System.LastSystemVersion</code>.</p>
</blockquote>
<h2 id="systemlastsystemversion">System.LastSystemVersion</h2>
<p>Takes the value of <code>EntityDataManager.GlobalVersion</code> after every single (job) component system update.</p>
<blockquote><p>The purpose of this version number is to be used in conjunction with <code>Chunk.ChangeVersion[]</code>.</p>
</blockquote>
<h2 id="chunkchangeversion-archetypechunkgetcomponentversion">Chunk.ChangeVersion<a href="ArchetypeChunk.GetComponentVersion"></a></h2>
<p>For each component type in the archetype, this array contains the value of <code>EntityDataManager.GlobalVersion</code> at the time the component array was last accessed as writeable within this chunk. This in no way guarantees that anything has effectively changed, only that it could have potentially changed.</p>
<p>Shared components can never be accessed as writeable, even if there is technically a version number stored for those too, it serves no purpose.</p>
<p>When using the <code>[ChangedFilter]</code> attribute in an <code>IJobProcessComponentData</code>, the <code>Chunk.ChangeVersion</code> for that specific component is compared to <code>System.LastSystemVersion</code>, so only chunks whose component arrays have been accessed as writeable since after the system last started running will be processed.</p>
<blockquote><p>If the amount of health points of a group of units is guaranteed not to have changed since the previous frame, checking if those units should update their damage model can be skipped altogether.</p>
</blockquote>
<h2 id="entitymanagermcomponenttypeorderversion">EntityManager.m_ComponentTypeOrderVersion[]</h2>
<p>For each non-shared component type, the version number is increased every time an iterator involving that type should become invalid. In other words, anything that might modify arrays of that type (not instances).</p>
<blockquote><p>If we have static objects identified by a particular component, and a per-chunk bounding box, we know we only need to update those bounding boxes if the type order version changes for that component.</p>
</blockquote>
<h2 id="sharedcomponentdatamanagermsharedcomponentversion">SharedComponentDataManager.m_SharedComponentVersion[]</h2>
<p>These version numbers increase when any structural change happens to the entities stored in a chunk referencing that shared component.</p>
<blockquote><p>Imagine we keep a count of entities per shared component, we can rely on that version number to only redo each count if the corresponding version number changes.</p>
</blockquote>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/Unity-Technologies/dots/blob/organize-docs/doc-src/manual/com.unity.entities/version_numbers.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &nbsp;
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
