<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-MC35ML');</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
  
    <title>Razor: GPU Profiling | Unity Technologies Developer Guide </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Razor: GPU Profiling | Unity Technologies Developer Guide ">
    <meta name="generator" content="docfx 2.40.7.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" class="manual">
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MC35ML" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
        
        		<div class="back-to-unity-group">
        			<a class="back-to-unity" href="http://docs.unity3d.com/">docs.unity3d.com</a>
        		</div>
        
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="razor-gpu-profiling">Razor: GPU Profiling</h1>

<p><strong>Razor for PS4</strong> is a profiling and debugging tool that is part of the PS4 SDK. It exists in two forms: <strong>Razor CPU</strong> for overview and CPU-related profiling, and <strong>Razor GPU</strong> for detailed GPU profiling. These tools are invaluable for investigating performance issues. This document covers <strong>Razor GPU</strong>. See the <a href="https://ps4.siedev.net/resources/documents/SDK/latest/Razor_GPU-Users_Guide/__document_toc.html">Razor User’s Guide</a> for a much more complete description of the product.</p>
<h2 id="when-to-use-razor-gpu">When to use Razor GPU</h2>
<h3 id="performanceoptimisation">Performance/Optimisation</h3>
<p>When a title is limited by CPU performance, it is what is known as &quot;CPU bound&quot;. In these scenarios, developers looking for higher frame rates should focus on optimizing CPU operations such as script code, physics, draw call batching, and so on.</p>
<p>When a title is limited by GPU performance, it is what is known as &quot;GPU bound&quot;. In these cases, developers should focus on optimizations on the GPU side such as shader code, screen resolution, and so on.</p>
<p>Razor GPU is an essential tool for profiling and directing optimizations for GPU bound titles.</p>
<p>The first step in performance investigation is to determine if your application is CPU or GPU bound using another tool from the PS4 SDK: Razor CPU. If you detect that GPU performance is an issue, you can then move to Razor GPU.</p>
<p>Please refer to our Basic Profiling with Razor CPU guide for an introduction to Razor CPU.</p>
<h3 id="debugging-rendering-issues">Debugging Rendering Issues</h3>
<p>In addition to profiling, Razor GPU is also a debugging tool. Use it whenever you are obtaining unexpected rendering results, for example, when creating your own shaders or trying new post process image effects. At times, you may want to use Razor GPU just to make sure everything is in order under the hood.</p>
<h2 id="capture-types">Capture Types</h2>
<p>Razor GPU works by taking data from a running application on a connected Devkit. There are two methods for getting this data: Captures and Traces. Both are accessible from the &quot;Capture&quot; menu and offer different sets of information.</p>
<h3 id="gpu-captures">GPU Captures</h3>
<p>This method captures information from a single frame of your game and allows to examine the operations performed during the frame. You can see it as an extended version of Unity’s integrated <a href="FrameDebugger.html">Frame Debugger</a>.</p>
<p>There is a huge amount of information in a capture. Razor GPU separates and shows it in a series of panels. Some examples of these panels are:</p>
<h4 id="workload-navigator-view">Workload Navigator view</h4>
<p><img src="../uploads/Main/PS4ProfilingWithRazor-0.png" alt=""></p>
<p>You can inspect Unity’s GPU user markers and render batches here. Also, optionally, you can visualize GPU durations corresponding to each marker.</p>
<h4 id="the-various-views-for-examining-resources">The Various Views For Examining Resources</h4>
<p><img src="../uploads/Main/PS4ProfilingWithRazor-1.png" alt=""></p>
<p>You can examine the graphic resources utilized during the rendering of the captured frame. Inspect all intermediate render targets, shaders, textures, and so on.</p>
<h4 id="replays">Replays</h4>
<p>From any GPU capture you can connect a Replay, which allows you step through the frame, much like <a href="FrameDebugger.html">Unity’s Frame Debugger</a>. To start a Replay use the ‘Connect Replay’ option from the Capture menu. Refer to the <a href="https://ps4.siedev.net/resources/documents/SDK/latest/Razor_GPU-Users_Guide/0009.html">Replaying GPU Captures document</a> for more information.</p>
<h3 id="gpu-traces">GPU Traces</h3>
<p>In addition to GPU Captures, Razor GPU offers GPU Traces, a more in-depth method of collecting data. Use it to get low level hardware information not available in GPU Captures. </p>
<p>Start by selecting the information you want to gather, choosing one of the presented presets, called Trace Groups. Unlike the GPU Capture, you can choose to capture from several frames and are not limited to just one. </p>
<p>Traces also include the Worldload Navigator you find in GPU Capture, but with added extra profiling data.</p>
<h4 id="trace-overview">Trace Overview</h4>
<p><img src="../uploads/Main/PS4ProfilingWithRazor-2.png" alt=""></p>
<p>Shows a convenient way to easily identify the GPU operations that are taking more time and require your attention. For example, in the image above you would want to tweak the Screen Space Ambient Occlusion image effect (bigger rectangle in the graph) so it takes less GPU time.</p>
<p>Note that the GPU timing of some Unity makers like Camera.Render or RenderDeferred.GBuffer is not 100% accurate as the marker only covers the frontend of the GPU and <a href="https://en.wikipedia.org/wiki/Graphics_Core_Next#CU_Scheduler">wavefronts</a> can run past the end of the marker. How accurate they are depends on what Unity does around them. Sometimes they are very accurate as Unity forces a wait, other times they are not accurate at all as most of the work flows out of them. You can use the Trace Timeline, shown in the next section, to tell where each Wavefront comes from.</p>
<h4 id="trace-timeline-view">Trace Timeline view</h4>
<p><img src="../uploads/Main/PS4ProfilingWithRazor-3.png" alt=""></p>
<p>Here you can visualize the GPU user markers in a timeline format (the purple rectangles in the above image). </p>
<p>You can also see a representation of all the <a href="https://en.wikipedia.org/wiki/Graphics_Core_Next#CU_Scheduler">Wavefronts</a> (the small colored rectangles forming blocks near the bottom of the image) going through the GPU and get information for each individual one using mouse over. The tool shows the Wavefronts for all the available kinds of shaders. Use this view to validate that the wavefronts are executing at the expected times and have the expected distribution, to find shaders expending more time than expected, and so on.</p>
<h2 id="unity-shader-cache">Unity Shader Cache</h2>
<p>Razor GPU needs to be supplied with extra shader debug information to show shader’s source code and enable the <a href="https://ps4.siedev.net/resources/documents/SDK/latest/GPU_Debugger-Users_Guide/__document_toc.html">GPU Debugger</a>. Here is an example of a Unity shader with its source code available in the tool:</p>
<p><img src="../uploads/Main/PS4ProfilingWithRazor-4.png" alt=""></p>
<p>The required debug information is contained in *.sdb files. During shader compilation, Unity can generate and store the corresponding *.sdb files in a folder specified by you. You just need to add the path of your desired folder as an Environment Variable in Windows using the UNITYSHADERCACHE variable name, as shown in the following image:</p>
<p><img src="../uploads/Main/PS4ProfilingWithRazor-5.png" alt=""></p>
<p>Setting the new environment variable requires a restart of the Unity Editor. Also you are required to recompile the shaders in your project. If shaders are already compiled and cached, you need to delete the project’s shader cache at <em>(your project folder)\Library\ShaderCache</em> to force a full recompilation. Finally, the next time you open a capture in Razor GPU it will ask for this folder, you just need to point to it.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2019 Unity Technologies<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
