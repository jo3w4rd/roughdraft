<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-MC35ML');</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
  
    <title>Playstation3: Trophies | Unity Technologies Developer Guide </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Playstation3: Trophies | Unity Technologies Developer Guide ">
    <meta name="generator" content="docfx 2.40.7.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" class="manual">
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MC35ML" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
        
        		<div class="back-to-unity-group">
        			<a class="back-to-unity" href="http://docs.unity3d.com/">docs.unity3d.com</a>
        		</div>
        
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="playstation3-trophies">Playstation3: Trophies</h1>

<h2 id="usage">Usage</h2>
<p>Unity allows you to use the Trophy System part of the PS3 by means of the NPToolkit class, which has now replaced the <a href="ScriptRef:PS3TrophyUtility.html">PS3TrophyUtility</a> class. As such any projects still using the old system will no longer have functionality for trophies, although they will still build and run. The PS3 sample package &quot;Trophy&quot; available within the release notes shows how to save and load trophies to/from the PS3.</p>
<p>Here is a table of nearest equivalent functions in the new NP system, compared to the old one:</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong><em>PS3TrophyUtility</em></strong></th>
<th style="text-align:left"><strong><em>NP Toolkit</em></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">GetTrophyCount</td>
<td style="text-align:left">Sony.NP.Trophies.GameInfo.numTrophies</td>
</tr>
<tr>
<td style="text-align:left">GetTrophyDescription(trophyId)</td>
<td style="text-align:left">Sony.NP.Trophies.TrophyDetails[trophyId].description</td>
</tr>
<tr>
<td style="text-align:left">GetTrophyName(trophyId)</td>
<td style="text-align:left">Sony.NP.Trophies.TrophyDetails[trophyId].name</td>
</tr>
<tr>
<td style="text-align:left">GetTrophyUnlockState(trophyId)</td>
<td style="text-align:left">Sony.NP.Trophies.TrophyData[trophyId].unlocked</td>
</tr>
<tr>
<td style="text-align:left">HasCompleted</td>
<td style="text-align:left">Sony.NP.Trophies.TrophiesAreAvailable</td>
</tr>
<tr>
<td style="text-align:left">UnlockTrophy(trophyId)</td>
<td style="text-align:left">Sony.NP.Trophies.AwardTrophy(trophyId)</td>
</tr>
</tbody>
</table>
<h3 id="1-initializing-the-toolkit">1. Initializing the Toolkit</h3>
<pre><code>using UnityEngine;
using System.Collections;

public class Example : MonoBehaviour {
    void Start(){
        // Register a callback for completion of NP initialization.
        Sony.NP.Main.OnNPInitialized += OnNPInitialized;

        // Initialize the NP Toolkit.
        Sony.NP.Main.Initialize(Sony.NP.Main.kNpToolkitCreate_CacheTrophyIcons);

        // NP event handlers for trophies
        Sony.NP.Trophies.OnGotGameInfo += OnTrophyGotGameInfo;
        Sony.NP.Trophies.OnGotTrophyInfo += OnTrophyGotTrophyInfo;
        Sony.NP.Trophies.OnAwardedTrophy += OnSomeEvent;
        Sony.NP.Trophies.OnAwardTrophyFailed += OnSomeEvent;
        Sony.NP.Trophies.OnAlreadyAwardedTrophy += OnSomeEvent;
        Sony.NP.Trophies.OnUnlockedPlatinum += OnSomeEvent;
    }

    void Update(){
        // The main update loop that keeps the messaging pumping and event handling working
        Sony.NP.Main.Update();
    }

    void OnNPInitialized(Sony.NP.Messages.PluginMessage msg){
        // NP has been fully initialized so it&#39;s now safe to sign in.
        Sony.NP.User.SignIn();
    }

    void OnSomeEvent(Sony.NP.Messages.PluginMessage msg){
        Debug.Log(&quot;Event: &quot; + msg.type);

        // Get the info for the trophies to reflect any changes that may have occurred
        UpdateTrophies();
    }
}
</code></pre><p>The Toolkit will require the use of event handlers for callbacks on most functions. Through these you will be able to act upon the kit when it&#39;s ready, rather than checking for it to be ready yourself.  Please note that in order for the NPToolkit to process messages and events, you will need to regularly call on <code>Sony.NP.Main.Update()</code> (in the example above, we do this in Update).</p>
<h3 id="2-retrieving-the-current-trophies">2. Retrieving the Current Trophies</h3>
<p>Extending the example above, we can now attempt to retrieve Trophies from the Toolkit. Once the system receives a callback stating that we&#39;ve received our Game Info, we know that the toolkit is ready. Then we simply need to request Trophy Info and await for the event handler we set up previously.</p>
<pre><code>void UpdateTrophies()
{
    // Get the latest trophy info if we&#39;re signed in and aren&#39;t already requesting them
    if(Sony.NP.User.IsSignedIn &amp;&amp; Sony.NP.Trophies.TrophiesAreAvailable &amp;&amp; !Sony.NP.Trophies.RequestTrophyInfoIsBusy())
    {
        Sony.NP.Trophies.RequestTrophyInfo();
    }
}

void OnTrophyGotGameInfo(Sony.NP.Messages.PluginMessage msg)
{
    /* This is the game info, within this we have all the information for the game
     * such as the title, number of trophies, and number of trophies within each
     * grade (bronze, silver, gold, platinum) */
    gameInfo = Sony.NP.Trophies.GetCachedGameInfo();

    // Get the info for the trophies
    UpdateTrophies();
}

void OnTrophyGotTrophyInfo(Sony.NP.Messages.PluginMessage msg)
{
    /* These are the trophies themselves. TrophyDetails contains the grade, name,
     * description, ID and hidden state for each Trophy. TrophyData contains the
     * icon information and unlocked state for each of the trophies. */
    trophyDetails = Sony.NP.Trophies.GetCachedTrophyDetails();
    trophyData = Sony.NP.Trophies.GetCachedTrophyData();
}
</code></pre><p>Note that whenever there has been a change to the current list of trophies such as when a trophy is awarded (see below) we will need to update the list of trophies again.</p>
<p>!!!3. Awarding/Unlocking Trophies
After we&#39;ve initialized and retrieved the trophies, we can then unlock them. Extending the above example:</p>
<pre><code>void UnlockTrophy(int trophyId)
{
    if(!trophyData[trophyId].unlocked)
    {
        // Award a trophy if we&#39;re signed in and have all our trophies available
        if(Sony.NP.User.IsSignedIn &amp;&amp; Sony.NP.Trophies.TrophiesAreAvailable)
        {
            Sony.NP.Trophies.AwardTrophy(trophyId);
        }
    }
}
</code></pre><p>Note that attempting to award a trophy that is already unlocked will display an error message, so it is important to check if it has already been awarded in the list we retrieved previously.</p>
<p>Once you have verified the locked state of the trophy you are trying to award, you can then proceed to unlock it. At this point you should check if the NP User is signed in and that the trophies system is available, otherwise unlocking will fail.</p>
<h3 id="4-displaying-trophies">4. Displaying Trophies</h3>
<p>It is possible to get the details of each specific Trophy from the data we retrieved previously. Extending the example again:</p>
<pre><code>void OnGUI(){
    GUILayout.BeginHorizontal();

    if(trophyDetails != null)
    {
        for(int i=0; i&lt;gameInfo.numTrophies; i++)
        {
            GUILayout.BeginVertical();

            GUILayout.Label(&quot;(&quot; + trophyDetails[i].trophyId + &quot;)&quot;);
            GUILayout.Label(&quot;Name: &quot; + trophyDetails[i].name);
            GUILayout.Label(&quot;Desc: &quot; + trophyDetails[i].description);
            GUILayout.Label(&quot;Unlocked : &quot; + trophyData[i].unlocked);

            GUILayout.EndVertical();
        }
    }

    GUILayout.EndHorizontal();
}
</code></pre><p>One advantage of the new NP Toolkit over the old system is the ability to display icons for trophies. Note however that <code>hasIcon</code> will always return false if the trophy is currently locked. Add the following in to your OnTrophyGotTrophyInfo function:</p>
<pre><code>// Store the trophy icons now so we&#39;re not creating them every frame in OnGUI!
trophyIcons = new Texture[gameInfo.numTrophies];
for(int i=0; i&lt;gameInfo.numTrophies; i++)
{
    if(trophyData[i].hasIcon)
        trophyIcons[i] = trophyData[i].icon;
}
</code></pre><p>And then add the following to your OnGUI display of trophies:</p>
<pre><code>if(trophyData[i].hasIcon)
    GUILayout.Box(trophyIcons[i]);
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2019 Unity Technologies<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
